
# Empirical Results

```{r setup, include = FALSE}
source("misc/load_libraries.R")
knitr::opts_chunk$set(include = FALSE, echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
```

```{r load data}
data <- read_rds("data/final/data.RDS")
```

```{r function to extract coefficients}
# because I'm only running log-linear regressions, I set it to return a string
# with a percentage rounded to 2 decimal places
extract_coef <- function(model, var) {
    coefs <- coef(model)
    result <- (coefs[var] * 100) %>% as.double() %>% round(2) %>% as.character()
    return(str_c(result, "%"))
}
```

```{r naive model}
naive_mdl <- felm(ln_price ~ award, data = data, subset = type_of_sale == "New Sale")
summary(naive_mdl)
```

```{r naive model with controls}
naive_mdl_with_controls <- felm(
    ln_price ~ award + ln_area + floor + hdb_buyer, 
    data = data, subset = type_of_sale == "New Sale")
summary(naive_mdl_with_controls)
```

```{r model with controls and year-quarter FE}
naive_mdl_with_controls_yqfe <- felm(
    ln_price ~ award + ln_area + floor + hdb_buyer + yq_sale, 
    data = data, subset = type_of_sale == "New Sale")
summary(naive_mdl_with_controls_yqfe)
```

```{r main results, include = TRUE, results = "asis"}
vars_to_keep <- names(coef(naive_mdl_with_controls))[-1] # exclude intercept
labels <- vars_to_keep %>% 
    str_replace_all("type_of_sale", "Type of Sale: ") %>% 
    str_replace_all("_", " ") %>% 
    str_to_title() %>% 
    str_replace_all("Award", "GM Award (1 = Yes)") %>% 
    str_replace_all("Ln Area", "ln(Area)") %>% 
    str_replace_all("Hdb Buyer", "HDB Buyer")
year_qtr_fe <- c("Year-Quarter Fixed Effects", "No", "No", "Yes")
stargazer(naive_mdl, naive_mdl_with_controls, naive_mdl_with_controls_yqfe, 
          type = "latex", title = "Effects of GM Award on Price",
          keep = vars_to_keep, order = vars_to_keep, covariate.labels = labels,
          dep.var.labels = "Natural log of Price", header = FALSE,
          add.lines = list(year_qtr_fe), label = "mainresults")
```

```{r DID base model}
did_base_mdl <- lm(ln_price ~ award + after_gm + ln_area + floor + hdb_buyer + yq_sale, 
    data = data, subset = type_of_sale == "New Sale")
summary(did_base_mdl)
```

```{r DID results, include = TRUE, results = "asis"}
vars_to_keep <- names(coef(did_base_mdl))[-1] # exclude intercept
vars_to_keep <- vars_to_keep[!str_detect(vars_to_keep, "yq_sale")] # exclude yq dummies
labels <- vars_to_keep %>% 
    str_replace_all("type_of_sale", "Type of Sale: ") %>% 
    str_replace_all("_", " ") %>% 
    str_to_title() %>% 
    str_replace_all("Award", "GM Award (1 = Yes)") %>% 
    str_replace_all("After Gm", "GM x After GM (1 = Yes)") %>% 
    str_replace_all("Ln Area", "ln(Area)") %>% 
    str_replace_all("Hdb Buyer", "HDB Buyer")
year_qtr_fe <- c("Year-Quarter Fixed Effects", "Yes")
stargazer(did_base_mdl, 
          type = "latex", title = "Difference-in-difference Models",
          keep = vars_to_keep, order = vars_to_keep, covariate.labels = labels,
          dep.var.labels = "Natural log of Price", header = FALSE,
          add.lines = list(year_qtr_fe), label = "didresults")
```

```{r placebo models}
placebo_6mo_mdl <- lm(ln_price ~ award + placebo_after_gm_6mo + ln_area + floor + hdb_buyer + yq_sale,
    data = data, subset = type_of_sale == "New Sale" & placebo_after_gm_flag == 1)
placebo_12mo_mdl <- lm(ln_price ~ award + placebo_after_gm_12mo + ln_area + floor + hdb_buyer + yq_sale,
    data = data, subset = type_of_sale == "New Sale" & placebo_after_gm_flag == 1)
#summary(placebo_12mo_mdl)
```

```{r placebo results, include = TRUE, results = "asis"}
vars_to_keep <- c("award", "placebo_after_gm_6mo", "placebo_after_gm_12mo", "ln_area", "floor", "hdb_buyer")
labels <- c("GM Award (1 = Yes)", "GM x After (6 months before GM), 1 = Yes", 
            "GM x After (12 months before GM), 1 = Yes",
            "ln(Area)", "Floor", "HDB Buyer")
year_qtr_fe <- c("Year-Quarter Fixed Effects", "Yes", "Yes")
stargazer(placebo_6mo_mdl, placebo_12mo_mdl,
          type = "latex", title = "Placebo Difference-in-difference Tests",
          keep = vars_to_keep, order = vars_to_keep, covariate.labels = labels,
          dep.var.labels = "Natural log of Price", header = FALSE,
          add.lines = list(year_qtr_fe), label = "placeboresults")
```


\newpage